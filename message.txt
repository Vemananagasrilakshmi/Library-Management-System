create database Library_management_system;
 use Library_management_system; 
 -- Table: tbl_publisher 
 CREATE TABLE tbl_publisher ( 
 publisher_PublisherName VARCHAR(255) PRIMARY KEY, 
 publisher_PublisherAddress TEXT, 
 publisher_PublisherPhone VARCHAR(15) 
 );
 CREATE TABLE tbl_book (
    book_BookID INT PRIMARY KEY,
    book_Title VARCHAR(255),
    book_PublisherName VARCHAR(255),
    FOREIGN KEY (book_PublisherName) REFERENCES tbl_publisher(publisher_PublisherName)
);
CREATE TABLE tbl_book_authors (
    book_authors_AuthorID INT PRIMARY KEY AUTO_INCREMENT,
    book_authors_BookID INT,
    book_authors_AuthorName VARCHAR(255),
    FOREIGN KEY (book_authors_BookID) REFERENCES tbl_book(book_BookID)
);
CREATE TABLE tbl_library_branch (
    library_branch_BranchID INT PRIMARY KEY AUTO_INCREMENT,
    library_branch_BranchName VARCHAR(255),
    library_branch_BranchAddress TEXT
);
CREATE TABLE tbl_book_copies (
    book_copies_CopiesID INT PRIMARY KEY AUTO_INCREMENT,
    book_copies_BookID INT,
    book_copies_BranchID INT,
    book_copies_No_Of_Copies INT,
    FOREIGN KEY (book_copies_BookID) REFERENCES tbl_book(book_BookID),
    FOREIGN KEY (book_copies_BranchID) REFERENCES tbl_library_branch(library_branch_BranchID)
);
CREATE TABLE tbl_borrower (
    borrower_CardNo INT PRIMARY KEY,
    borrower_BorrowerName VARCHAR(255),
    borrower_BorrowerAddress TEXT,
    borrower_BorrowerPhone VARCHAR(15)
);
CREATE TABLE tbl_book_loans (
    book_loans_LoansID INT PRIMARY KEY AUTO_INCREMENT,
    book_loans_BookID INT,
    book_loans_BranchID INT,
    book_loans_CardNo INT,
    book_loans_DateOut DATE,
    book_loans_DueDate DATE,
    FOREIGN KEY (book_loans_BookID) REFERENCES tbl_book(book_BookID),
    FOREIGN KEY (book_loans_BranchID) REFERENCES tbl_library_branch(library_branch_BranchID),
    FOREIGN KEY (book_loans_CardNo) REFERENCES tbl_borrower(borrower_CardNo)
);
select*from tbl_book_loans;

/*1.How many copies of the book titled "The Lost Tribe" are owned by the library branch whose name is "Sharpstown"?*/
SELECT
    bc.book_copies_No_Of_Copies,
    b.book_Title,
    lb.library_branch_BranchName
FROM tbl_book_copies AS bc
JOIN tbl_book AS b
    ON bc.book_copies_BookID = b.book_BookID
JOIN tbl_library_branch AS lb
    ON bc.book_copies_BranchID = lb.library_branch_BranchID
WHERE b.book_Title = 'The Lost Tribe'
  AND lb.library_branch_BranchName = 'Sharpstown';
  
/*2How many copies of the book titled "The Lost Tribe" are owned by each library branch?*/
SELECT
    sum(bc.book_copies_No_Of_Copies),
    b.book_Title,
    lb.library_branch_BranchName
FROM tbl_book_copies AS bc
JOIN tbl_book AS b
    ON bc.book_copies_BookID = b.book_BookID
JOIN tbl_library_branch AS lb
    ON bc.book_copies_BranchID = lb.library_branch_BranchID
where b.book_Title="The Lost Tribe"
 group by lb.library_branch_BranchName;
 
 /*3.Retrieve the names of all borrowers who do not have any books checked out.*/
 select 
 b.borrower_BorrowerName from tbl_borrower as b 
 left join tbl_book_loans as bl on b.borrower_CardNo=bl.book_loans_CardNo
WHERE bl.book_loans_LoansID IS NULL;
/*4For each book that is loaned out from the "Sharpstown" branch and whose DueDate is 2/3/18, 
retrieve the book title, the borrower's name, and the borrower's address.*/
SELECT 
    b.book_Title,
    br.borrower_BorrowerName,
    br.borrower_BorrowerAddress,
    lb.library_branch_BranchName
FROM tbl_book_loans AS l
JOIN tbl_book AS b
    ON l.book_loans_BookID = b.book_BookID
JOIN tbl_borrower AS br
    ON l.book_loans_CardNo = br.borrower_CardNo
JOIN tbl_library_branch AS lb
    ON l.book_loans_BranchID = lb.library_branch_BranchID
WHERE lb.library_branch_BranchName = 'Sharpstown'
  AND l.book_loans_DueDate = '2-3-18';


/*5.For each library branch, retrieve the branch name and the total number of books loaned out from that branch.*/
select 
lb.library_branch_BranchName,
count(bl.book_loans_LoansID) from tbl_library_branch as lb 
join tbl_book_loans as bl on bl.book_loans_BranchID=lb.library_branch_BranchID
group by lb.library_branch_BranchName;


/*6.Retrieve the names, addresses, and number of books checked out for all borrowers who have more than five books checked out.*/
select*from tbl_borrower;
select*from tbl_book_loans;
select 
br.borrower_CardNo,
br.borrower_BorrowerName,
count(bl.book_loans_LoansID) as count,
br.borrower_BorrowerAddress from tbl_borrower as br 
join tbl_book_loans as bl on br.borrower_CardNo=bl.book_loans_CardNo
group by borrower_CardNo
having count>5;

/*7.For each book authored by "Stephen King", 
retrieve the title and 
the number of copies owned by the library branch whose name is "Central".*/
select*from tbl_book_authors;
select*from tbl_book;
select b.book_BookID,b.book_Title,bc.book_copies_No_Of_Copies from tbl_book as b 
join tbl_book_authors ba 
    on b.book_BookID=ba.book_authors_BookID
join tbl_book_copies AS bc
    on b.book_BookID = bc.book_copies_BookID
join tbl_library_branch AS lb
    on bc.book_copies_BranchID = lb.library_branch_BranchID 
where book_authors_AuthorName="Stephen King"
and lb.library_branch_BranchName = 'Central';

-- Which members have borrowed the highest number of books?

select br.borrower_CardNo,count(bl.book_loans_LoansID) as count from tbl_borrower as br 
join tbl_book_loans as bl on br.borrower_CardNo=bl.book_loans_CardNo
group by borrower_CardNo
order by count desc limit 1;

-- how many books are available in each branch
select*from tbl_book;
select*from tbl_library_branch;
select*from tbl_book_copies;
select lb.library_branch_BranchName,count(bc.book_copies_No_Of_Copies) as count from tbl_book_copies bc
join tbl_library_branch lb 
on bc.book_copies_BranchID=lb.library_branch_BranchID 
group by lb.library_branch_BranchName
order by count desc;

-- Which library branch has the most books currently on loan?
SELECT 
    lb.library_branch_BranchName,
    COUNT(bl.book_loans_LoansID) AS TotalLoans
FROM tbl_library_branch AS lb
JOIN tbl_book_loans AS bl
    ON lb.library_branch_BranchID = bl.book_loans_BranchID
GROUP BY lb.library_branch_BranchName
ORDER BY TotalLoans DESC
LIMIT 1;

-- Which authorsâ€™ books are most frequently borrowed?
SELECT 
    ba.book_authors_AuthorName,
    COUNT(bl.book_loans_LoansID) AS TotalBorrows
FROM tbl_book_authors AS ba
JOIN tbl_book AS b
    ON ba.book_authors_BookID = b.book_BookID
JOIN tbl_book_loans AS bl
    ON b.book_BookID = bl.book_loans_BookID
GROUP BY ba.book_authors_AuthorName
ORDER BY TotalBorrows DESC
LIMIT 1;

-- Which registered borrowers have not borrowed any books?
SELECT 
    br.borrower_BorrowerName,
    br.borrower_BorrowerAddress
FROM tbl_borrower AS br
LEFT JOIN tbl_book_loans AS bl
    ON br.borrower_CardNo = bl.book_loans_CardNo
WHERE bl.book_loans_LoansID IS NULL;









